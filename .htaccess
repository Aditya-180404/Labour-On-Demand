############################################
# Core Settings
############################################

# Disable directory listing (Commented out for InfinityFree compatibility)
# Options -Indexes

# Protect .htaccess itself
<Files ".htaccess">
Require all denied
</Files>


############################################
# Rewrite Engine
############################################
<IfModule mod_rewrite.c>
RewriteEngine On

# Block common attack patterns in Query String
RewriteCond %{QUERY_STRING} (\.\./|union|select|insert|drop|script|eval\(|base64_) [NC]
RewriteRule .* - [F,L]

# ------------------------------------------
# Force HTTPS (Cloudflare + Proxy aware)
# ------------------------------------------
# RewriteCond %{HTTPS} !=on
# RewriteCond %{HTTP:X-Forwarded-Proto} !https
# RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ------------------------------------------
# Force www (optional â€” remove if not needed)
# ------------------------------------------
# RewriteCond %{HTTP_HOST} !^www\. [NC]
# RewriteRule ^ https://www.%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ------------------------------------------
# Block malicious bots & mirroring tools
# ------------------------------------------
RewriteCond %{HTTP_USER_AGENT} (Baiduspider|HTTrack|YandexBot|AhrefsBot|DotBot|MJ12bot|SemrushBot|wget|curl|libwww-perl|python|scrapy|kyptec|go-http-client) [NC]
RewriteRule .* - [F,L]

# ------------------------------------------
# Hotlink Protection (Images & Assets)
# ------------------------------------------
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?labour-on-demand\.infinityfreeapp\.com [NC]
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?localhost [NC]
RewriteRule \.(css|js|png|jpg|jpeg|webp|svg|pdf)$ - [F,NC]

</IfModule>

############################################
# Security Headers
############################################
<IfModule mod_headers.c>

Header always set X-Content-Type-Options "nosniff"
Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"

# Enable HSTS (ONLY after SSL works perfectly)
# Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"

</IfModule>

# Block Sensitive Files (Specific files and dangerous extensions)
<FilesMatch "^\.|\.(sql|zip|bak|log|lock|env|htaccess|git|antigravity)$|^(config|credentials|secret|pass|db|composer|package)\.(php|json|ini|lock)$">
Require all denied
</FilesMatch>

# Limit request size (10MB)
LimitRequestBody 10485760

############################################
# PHP Hardening
############################################
<IfModule mod_php.c>
php_flag display_errors Off
php_flag expose_php Off
</IfModule>

# Upload Limits & Timeouts
php_value upload_max_filesize 20M
php_value post_max_size 150M
php_value max_file_uploads 30
php_value max_input_time 300
php_value max_execution_time 300

############################################
# Compression
############################################
<IfModule mod_deflate.c>
AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/json
</IfModule>

############################################
# Browser Caching
############################################
<IfModule mod_expires.c>
ExpiresActive On
ExpiresDefault "access plus 1 month"

ExpiresByType image/jpeg "access plus 1 year"
ExpiresByType image/png  "access plus 1 year"
ExpiresByType image/webp "access plus 1 year"
ExpiresByType image/svg+xml "access plus 1 year"

ExpiresByType text/css "access plus 1 month"
ExpiresByType application/javascript "access plus 1 month"
</IfModule>
